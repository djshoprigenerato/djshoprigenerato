<%- include('../layouts/main') %><h1><%= p ? 'Modifica prodotto' : 'Nuovo prodotto' %></h1><form method='post' enctype='multipart/form-data' style='display:grid;gap:12px;grid-template-columns:repeat(12,1fr)'><div style='grid-column:span 6'><label>Titolo</label><input name='title' value='<%= p?.title||'' %>' required></div><div style='grid-column:span 3'><label>Categoria</label><select name='category_id'><option value=''>--</option><% cats.forEach(c=>{ %><option value='<%= c.id %>' <%= p && p.category_id===c.id?'selected':'' %>><%= c.name %></option><% }) %></select></div><div style='grid-column:span 3'><label>Prezzo (â‚¬)</label><input name='price' type='number' step='0.01' value='<%= p ? (p.price_cents/100).toFixed(2) : '' %>' required></div><div style='grid-column:span 12'><label>Descrizione</label><textarea name='description' rows='6'><%= p?.description||'' %></textarea></div><div style='grid-column:span 12'><label>Immagini (multiple)</label><input type='file' name='images' accept='image/*' multiple></div><% if(p){ %><div style='grid-column:span 12'><label>Immagini esistenti (spunta per rimuovere)</label><div class='grid' style='grid-template-columns:repeat(6,1fr)'><% (p.images||[]).forEach(im=>{ %><label class='card'><img src='<%= im.url %>' style='width:100%;height:120px;object-fit:cover'><div class='body'><input type='checkbox' name='remove_keys' value='<%= im.key %>'> Rimuovi</div></label><% }) %></div></div><% } %><div style='grid-column:span 3'><label>Pubblicato</label><input type='checkbox' name='published' <%= p?.published?'checked':'' %>></div><div style='grid-column:span 12'><button class='btn primary'>Salva</button></div></form>