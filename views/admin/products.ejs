<%- include('../layouts/flash') %>

<div class="page-header">
  <h1>Prodotti</h1>
  <a class="btn" href="/admin/products/new">+ Nuovo prodotto</a>
</div>

<form method="get" action="/admin/products" class="filters">
  <input type="text" name="q" value="<%= q || '' %>" placeholder="Cerca titolo/descrizione…" />
  <select name="category">
    <option value="">Tutte le categorie</option>
    <% (cats||[]).forEach(c => { %>
      <option value="<%= c.slug %>" <%= category===c.slug?'selected':'' %>><%= c.name %></option>
    <% }) %>
  </select>
  <button class="btn" type="submit">Filtra</button>
</form>

<table class="table">
  <thead>
    <tr>
      <th>ID</th><th>Titolo</th><th>Categoria</th><th>€</th><th>Pubblicato</th><th>Creato</th><th></th>
    </tr>
  </thead>
  <tbody>
    <% (products||[]).forEach(p => { %>
      <tr>
        <td><%= p.id %></td>
        <td><a href="/product/<%= p.slug %>" target="_blank"><%= p.title %></a></td>
        <td><%= p.category_name || '-' %></td>
        <td><%= (p.price_cents/100).toFixed(2) %></td>
        <td><%= p.is_active ? 'Sì' : 'No' %></td>
        <td><%= new Date(p.created_at).toLocaleString('it-IT') %></td>
        <td class="actions">
          <a class="btn" href="/admin/products/<%= p.id %>/edit">Modifica</a>
          <form method="post" action="/admin/products/<%= p.id %>/delete" onsubmit="return confirm('Eliminare questo prodotto?');">
            <button class="btn btn-danger" type="submit">Elimina</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<style>
.page-header{display:flex;align-items:center;justify-content:space-between;margin:16px 0}
.filters{display:flex;gap:8px;margin:12px 0}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid #1f2937}
.actions{display:flex;gap:8px}
.btn{padding:8px 12px;border-radius:8px;background:#374151;color:#fff;text-decoration:none;border:0;cursor:pointer}
.btn-danger{background:#b91c1c}
</style>
