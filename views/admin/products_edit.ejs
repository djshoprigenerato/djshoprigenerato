<h1 class="page-title">Modifica prodotto</h1>

<form method="post" action="/admin/products/<%= p.id %>" enctype="multipart/form-data" style="display:grid;gap:10px;max-width:640px">
  <label>Titolo</label>
  <input type="text" name="title" value="<%= p.title %>" required>

  <label>Categoria</label>
  <select name="category_id" required>
    <% (cats||[]).forEach(c => { %>
      <option value="<%= c.id %>" <%= (p.category_id===c.id?'selected':'') %>><%= c.name %></option>
    <% }) %>
  </select>

  <label>Prezzo (€)</label>
  <input type="number" name="price" step="0.01" min="0" value="<%= (p.price_cents/100).toFixed(2) %>" required>

  <label>Descrizione</label>
  <textarea name="description" rows="6"><%= p.description || '' %></textarea>

  <fieldset style="border:1px dashed #374151;padding:10px;border-radius:8px">
    <legend>Immagine</legend>
    <% if (p.image) { %>
      <img src="<%= p.image %>" alt="" style="max-width:180px;border-radius:6px;margin-bottom:8px">
    <% } %>
    <div style="display:flex;gap:10px;align-items:center">
      <div>
        <div>Carica nuovo file</div>
        <input type="file" name="image" accept="image/*">
      </div>
      <div>oppure</div>
      <div>
        <div>URL immagine (sovrascrive)</div>
        <input type="url" name="image_url" placeholder="https://…">
      </div>
    </div>
  </fieldset>

  <label style="display:flex;gap:8px;align-items:center">
    <input type="checkbox" name="is_active" value="1" <%= p.is_active ? 'checked' : '' %> > Pubblicato
  </label>

  <div style="display:flex;gap:8px">
    <button class="btn">Salva</button>
    <a class="btn" href="/admin/products">Annulla</a>
  </div>
</form>

<form method="post" action="/admin/products/<%= p.id %>/delete" onsubmit="return confirm('Eliminare definitivamente?');" style="margin-top:12px">
  <button class="btn btn-danger">Elimina prodotto</button>
</form>
