<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= (typeof title !== 'undefined' && title) ? title : 'DJSHOPRIGENERATO' %> · DJSHOPRIGENERATO</title>
  <meta name="description" content="DJSHOPRIGENERATO - Re-Mix. Re-Fix. Re-Use. Attrezzatura DJ rigenerata, testata e pronta al beat. Spedizione gratuita con SDA & GLS.">
  <link rel="stylesheet" href="/public/css/styles.css">
  <link rel="icon" href="/public/favicon.ico" />
</head>
<body>
  <header style="background:#0b0f14;color:#f3f4f6;padding:12px 18px;border-bottom:1px solid #1f2937;">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div style="display:flex;align-items:center;gap:12px;">
        <a href="/" style="display:flex;align-items:center;gap:10px;color:inherit;text-decoration:none;">
          <img src="/public/img/logo.jpg" alt="DJSHOPRIGENERATO" style="height:32px;border-radius:6px;object-fit:cover;">
          <strong>DJSHOPRIGENERATO</strong>
        </a>
        <nav style="margin-left:16px;">
          <a href="/about" style="color:inherit;text-decoration:none;margin-right:12px;">Chi siamo</a>
          <a href="/faq" style="color:inherit;text-decoration:none;margin-right:12px;">FAQ</a>
          <a href="/cart" style="color:inherit;text-decoration:none;">
            Carrello (
            <% 
              var cartCount = 0; 
              if (session && Array.isArray(session.cart)) {
                for (var i=0;i<session.cart.length;i++){ cartCount += (session.cart[i].quantity || 0); }
              }
            %>
            <%= cartCount %>
            )
          </a>
        </nav>
      </div>
      <div>
        <% if (currentUser) { %>
          <span class="badge">Ciao, <%= currentUser.name || currentUser.email %></span>
          <% if (currentUser.is_admin) { %><a href="/admin" style="margin-left:10px;">Admin</a><% } %>
          <form method="post" action="/logout" style="display:inline;">
            <button class="btn secondary" type="submit" style="margin-left:8px;">Esci</button>
          </form>
        <% } else { %>
          <a href="/login" style="margin-right:10px;">Accedi</a>
          <a href="/register">Registrati</a>
        <% } %>
      </div>
    </div>
  </header>

  <div id="announcement" style="background:#0f172a;border-bottom:1px solid #1f2937;">
    <div class="container" style="padding:8px 16px;color:#f59e0b;font-weight:700;">
      Re-Mix. Re-Fix. Re-Use. · <span class="ship-badge">Spedizione gratuita con SDA & GLS</span>
    </div>
  </div>

  <div class="container">
    <% if (typeof flash !== 'undefined' && flash) { %>
      <div class="flash <%= flash.type %>"><%= flash.msg %></div>
    <% } %>
    <%- body %>
  </div>

  <footer>
    <div class="container" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
      <div>
        <strong>DJSHOPRIGENERATO</strong><br>
        <small>Re-Mix. Re-Fix. Re-Use.</small>
        <nav style="margin-top:8px;display:flex;flex-wrap:wrap;gap:12px;">
          <a href="/refurb">Processo Rigenerazione</a>
          <a href="/warranty">Garanzia</a>
          <a href="/shipping">Spedizioni & Resi</a>
          <a href="/privacy">Privacy</a>
          <a href="/terms">Termini</a>
        </nav>
      </div>
      <div class="card" style="background:transparent;border:1px dashed #1f2937;">
        Spedizione sempre gratuita in Italia con SDA e GLS.
      </div>
    </div>
    <div style="margin-top:10px;color:#9ca3af;">© <script>document.write(new Date().getFullYear())</script> DJSHOPRIGENERATO</div>
  </footer>
</body>
</html>
